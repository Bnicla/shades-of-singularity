---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getEntry, getCollection, render } from 'astro:content';
import '../../styles/appendix.css';

const appendixEntry = await getEntry('appendix', 'appendix');
const { Content: MatrixContent } = await render(appendixEntry);

const scenarios = await getCollection('scenarios');
scenarios.sort((a, b) => a.data.number - b.data.number);

const tiers = [
  { tier: 1, label: 'Near-Certain', scenarios: scenarios.filter(s => s.data.tier === 1) },
  { tier: 2, label: 'Highly Probable', scenarios: scenarios.filter(s => s.data.tier === 2) },
  { tier: 3, label: 'Plausible', scenarios: scenarios.filter(s => s.data.tier === 3) },
  { tier: 4, label: 'Possible', scenarios: scenarios.filter(s => s.data.tier === 4) },
  { tier: 5, label: 'Speculative', scenarios: scenarios.filter(s => s.data.tier === 5) },
];
---

<BaseLayout
  title="The 28 Scenarios"
  description="Twenty-eight scenarios for the AI future, ranked by likelihood and scored by governance dividend."
>
  <header class="appendix-header">
    <h1 class="appendix-title">The 28 Scenarios</h1>
    <p class="appendix-subtitle">The Shades of Singularity</p>
  </header>

  <div class="content-column">
    <p class="scenarios-intro">
      These are the twenty-eight scenarios from which the essays in this collection are painted. They are not competing predictions. The future will not select one and discard the rest. It will combine many of them, shades layered over one another on the same canvas, each altering the color of what lies beneath.
    </p>
    <p class="scenarios-intro">
      Each scenario is scored on two axes: the outcome if left <strong>unmanaged</strong> and the outcome if <strong>governed</strong> well. The gap between the two is the <strong>Governance Dividend</strong> - the measure of what institutional design can accomplish, and the reason this collection exists.
    </p>
  </div>

  <!-- Scenario Cards by Tier -->
  <div class="content-column">
    <h2 class="scenarios-heading">The Scenarios</h2>

    {tiers.map((tierGroup) => (
      <section class="tier-section">
        <h3 class="tier-label">Tier {tierGroup.tier}: {tierGroup.label}</h3>
        <div class="scenario-grid">
          {tierGroup.scenarios.map((scenario) => (
            <a href={`/scenarios/${scenario.data.slug}/`} class="scenario-card">
              <div class="scenario-card-header">
                <span class="scenario-number">{scenario.data.number}</span>
                <span class="likelihood-badge">{scenario.data.likelihood}</span>
              </div>
              <h4 class="scenario-card-title">{scenario.data.title}</h4>
              <p class="scenario-card-summary">{scenario.data.summary}</p>
              <div class="scenario-card-scores">
                <span title="Unmanaged">U: {scenario.data.unmanaged}</span>
                <span title="Governed">G: {scenario.data.governed}</span>
                <span title="Dividend">D: {scenario.data.dividend}</span>
              </div>
            </a>
          ))}
        </div>
      </section>
    ))}
  </div>

  <!-- Outcome Matrix -->
  <div class="content-column appendix-content">
    <hr style="margin: var(--space-xl) 0 var(--space-lg);" />
    <MatrixContent />
  </div>
</BaseLayout>

<style>
  .scenarios-intro {
    font-size: var(--font-size-base);
    line-height: 1.7;
    color: var(--color-text-muted);
    margin-bottom: 1em;
  }

  .scenarios-intro:last-of-type {
    margin-bottom: var(--space-lg);
  }

  .scenarios-heading {
    font-family: var(--font-heading);
    font-size: var(--font-size-xl);
    text-align: center;
    margin-bottom: var(--space-lg);
  }

  .tier-section {
    margin-bottom: var(--space-lg);
  }

  .tier-label {
    font-family: var(--font-heading);
    font-size: var(--font-size-sm);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-text-muted);
    margin-bottom: var(--space-md);
    padding-bottom: var(--space-xs);
    border-bottom: 1px solid var(--color-rule);
  }

  .scenario-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
  }

  .scenario-card {
    display: block;
    padding: 1.25rem;
    border: 1px solid var(--color-rule);
    border-radius: 6px;
    text-decoration: none;
    color: var(--color-text);
    transition: border-color 0.15s ease, background-color 0.15s ease;
  }

  .scenario-card:hover {
    border-color: var(--color-accent);
    background-color: var(--color-accent-muted);
  }

  .scenario-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .scenario-number {
    font-family: var(--font-heading);
    font-size: var(--font-size-xs);
    font-weight: 600;
    color: var(--color-accent);
  }

  .scenario-card-title {
    font-family: var(--font-heading);
    font-size: var(--font-size-base);
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: 0.5rem;
  }

  .scenario-card-summary {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    line-height: 1.5;
    margin-bottom: 0.75rem;
  }

  .scenario-card-scores {
    display: flex;
    gap: 0.75rem;
    font-family: var(--font-heading);
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  @media (max-width: 640px) {
    .scenario-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
